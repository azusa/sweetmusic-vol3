

\lhead[]{}
\rhead[]{}
\chead[BDDの理論的背景]{BDDの理論的背景}

# BDDの理論的背景

本稿では、振る舞い駆動開発(Behavior Driven Development:BDD)について、テスト駆動開発(TDD)の生い立ちからBDDの発端までを辿ることで、BDDの理論的背景を明らかにするものです。

## TDDの憂鬱

TDDとは、プログラミングする過程の中に細かいサイクルで、自動化されたテストを組み込むとどのような開発プロセスが生まれるかといういうケント・ベック氏の思考実験から生まれた開発プロセスです。[@Beck2002]その意味を含めて、本稿ではTDDを「プログラミングとテストすることを工程として統合する開発スタイル」と定義します。

その中ではTDDで作成されるテストというのは、関数なり、メソッドなり、プログラムを実行する最小単位に対するテストである、いわゆる「ユニットテスト」であることを暗黙な前提として述べられています。

もともと関数やメソッドごとに、例えばC言語であればmain関数をエントリーポイントとして設けるというデバッグ手法は、動作確認を行うという熟練したプログラマーによって以前から行われていたプラクティスです。プログラムによって自動化されたユニットテストというのは、その手法を、フレームワークとしてパターン化したところというところに価値がありました。

プログラムを作成したプログラマー自らの手によって、徹底したデバッグと「容赦ないテスト」 [@Thomas2000] が行われ、バグが取り除かれたプログラム部品が提供されるということは、プログラムのモジュールをボトムアップで組み合わせ、システムとして結合する上で、結合フェーズでのバグの発見による手戻りを減らすという効果があります。

しかしながら、ユニットテストで確認される仕様というのは、ユーザーが画面等のユーザーインターフェースを通じて操作した結果としての振る舞いや、その上で実現されるワークフローのあるべき姿から導出されるものです。そして、ユニットテストでプログラムの振る舞いを確認したとしても、それはシステムとしての振る舞いや、ワークフローの正しさを確認することはできません。

にもかかわらず、ユニットテストとプログラミングの間を交互に行き来することによってプログラムの骨格を作っていくTDDという開発スタイルのインパクトがもたらすものは強烈です。そのインパクトは、TDDによるユニットテストのみでアプリケーションが動作に耐えうるだけの品質を担保できるという誤解を生み出し、成果物の受入工程においてステークホルダー間の齟齬を生み出すことになりました。

そのことを批判する論陣の先頭に立つのが、ソフトウェアパターンのコミュニティーにおいて初期から中心的な役割をつとめ、「Cope」として知られる、Jim Coplien氏です。氏のそのような主張は、「Why Most Unit Testing is Waste」という論文[@Coplien2014]にもっと色よく現れています。



その点において、TDDの歴史は、「テストはしたが動かないプログラム」を生み出してしまうという本質的に内在した弱点を克服するための改善の繰り返しの歴史でもありました。





## メソッドベースのテストとシナリオベースのテスト

TDDの問題点の一つとして、最もシンプルな形式であるオブジェクトのメソッド(引数)の呼び出しに対してテストを記述した場合に、エンドユーザーからのユースケースに従って順を追って呼び出された時の実際の呼び出しシーケンスと、テストからの呼び出しシーケンスが乖離するというものがあります。このことにTDDの普及期から取り組んだのが、1990年代後半から2000年代前半にかけて日本におけるオブジェクト指向開発とテスト駆動開発における論陣をリードした、故石井勝(まさーる)氏^[2005年4月、JR福知山線脱線事故にて逝去]です。

石井氏が生前Webサイトで公開していた内容は、現在オブラブ ^[[http://objectclub.jp/](http://objectclub.jp/)]がメンテナンスを引き継いで公開されています ^[[http://objectclub.jp/community/memorial/homepage3.nifty.com/masarl/](http://objectclub.jp/community/memorial/homepage3.nifty.com/masarl/)]。

石井氏は、「JUnit 実践講座 - シナリオベースのテストケースの書き方」[@Ishii2002]^[[http://objectclub.jp/community/memorial/homepage3.nifty.com/masarl/article/junit/scenario-based-testcase.html](http://objectclub.jp/community/memorial/homepage3.nifty.com/masarl/article/junit/scenario-based-testcase.html)]で、テストケースを二つの枠に分類しています。テストするクラスのメソッドをもとにメソッドを作成するメソッドベースのテストと、テストするクラスのシナリオを元にメソッドを作成するシナリオベースのテストの二つです。

メソッドベースのテストとシナリオベースのテストの分類では、データを保持するのを目的とするクラスやユーティリティ的なクラスにはメソッドベースを起こし、クラスの振る舞いにバリエーションがあるクラスは、テストパターンに応じてクラスのユースケースのシナリオを起こすシナリオベースのテスト記述を紹介しています。

石井氏の論陣は、当然当時のオブジェクト指向に関する世間の議論をベースとしていますから、ドメイン駆動設計(DDD)に代表されるその後のアプリケーションの設計に関する知見を取り込むことは出来ていませんが、それでもユニットテストの自動化を考えるにあたって、テストケースをどう構造化するかということに取り組んだ先達であり、その着眼点の鋭さは今日でも目を見はるものがあります。

## BDD

イギリスのコンサルタントであるDan North氏は2003年、JUnitとTDDの影響を受けて、JBehave^[[http://jbehave.org/](http://jbehave.org/)]というテスティングフレームワークの開発を始めます。その中で見いだした開発スタイルにBDD(behavior driven development)と命名し、その普及と啓蒙にあたるようになりました。

North氏によるBDDの出発点は、テストメソッドのメソッド名を、テストの対するドキュメンテーションとして使用するものです。これはNorth氏の同僚であるChris Stevenson氏が作成したagiledox ^[[http://agiledox.sourceforge.net/](http://agiledox.sourceforge.net/)]というユーティリティーに発想を得たものです。ここからユニットテストのテストは、メソッド(関数)をテストするための治具という位置づけから発展し、ソフトウェアの使用を記述するためのドキュメントとしての位置づけを得るようになります。


# 

RSpecは Steven Baker氏 Dave Astels氏、 Aslak Hellesøy氏、 David Chelimsky氏とともに2005年に開発をはじめたruby向けのテスティングフレームワークです。RSpecの特徴は、テストの記述をrubyを用いて言語内DSLとして記述することにあります。もともとrubyコミュニティーでは、タスクツールであるRakeをはじまりに、ブロック構文などのrubyの言語機能を生かして言語内DSLでツールを記述する文化があり、言語内DSLの特徴を最大限に生かしたがWebアプリケーションフレームワークであるRuby on Railsですが、North氏が発案したBDDの思想は、ここで言語内DSLというフォーマットを得ることにより、「実行可能な仕様」(Executable specification)という方向を目指すことになります。

## テストファーストと開発プロセスの統合

ところで、TDDの大きな特徴としてテストコードをプロダクションコードの先に書く「テストファースト」があげられますが、テストのタイミングを先倒しすることについては、TDDだけの専売特許ではありません。

「Shift Left Testing」

「Test Early and Often」

## Fit 

## Seleniumによるブラウザー自動化の萌芽

## Outside-in , Inside-out

## 「二重のフィードバックループ」  

BDDとは
